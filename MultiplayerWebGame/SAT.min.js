/* SAT.js - Version 0.4 - Copyright 2014 - Jim Riecken <jimr@jimr.ca> - released under the MIT License. https://github.com/jriecken/sat-js */
function w(){function a(b,k){this.x=b||0;this.y=k||0}function g(b,k){this.pos=b||new a;this.points=k||[];this.angle=0;this.offset=new a;this.recalc()}function u(b,k,c){this.pos=b||new a;this.w=k||0;this.h=c||0}function v(){this.b=this.a=null;this.overlapN=new a;this.overlapV=new a;this.clear()}function z(b,k,c){for(var a=Number.MAX_VALUE,e=-Number.MAX_VALUE,h=b.length,l=0;l<h;l++){var f=b[l].c(k);f<a&&(a=f);f>e&&(e=f)}c[0]=a;c[1]=e}function A(b,k,c,a,e,h){var l=q.pop(),f=q.pop();b=d.pop().copy(k).sub(b);
k=b.c(e);z(c,e,l);z(a,e,f);f[0]+=k;f[1]+=k;if(l[0]>f[1]||f[0]>l[1])return d.push(b),q.push(l),q.push(f),!0;h&&(c=0,l[0]<f[0]?(h.aInB=!1,l[1]<f[1]?(c=l[1]-f[0],h.bInA=!1):(c=l[1]-f[0],a=f[1]-l[0],c=c<a?c:-a)):(h.bInA=!1,l[1]>f[1]?(c=l[0]-f[1],h.aInB=!1):(c=l[1]-f[0],a=f[1]-l[0],c=c<a?c:-a)),a=Math.abs(c),a<h.overlap&&(h.overlap=a,h.overlapN.copy(e),0>c&&h.overlapN.reverse()));d.push(b);q.push(l);q.push(f);return!1}function x(b,k){var c=b.d(),a=k.c(b);return 0>a?-1:a>c?1:0}function B(b,k,c){for(var a=
d.pop().copy(k.pos).sub(b.pos),e=k.r,h=e*e,l=b.calcPoints,f=l.length,s=d.pop(),p=d.pop(),m=0;m<f;m++){var g=m===f-1?0:m+1,q=0===m?f-1:m-1,t=0,r=null;s.copy(b.edges[m]);p.copy(a).sub(l[m]);c&&p.d()>h&&(c.aInB=!1);var n=x(s,p);if(-1===n){s.copy(b.edges[q]);g=d.pop().copy(a).sub(l[q]);n=x(s,g);if(1===n){n=p.e();if(n>e)return d.push(a),d.push(s),d.push(p),d.push(g),!1;c&&(c.bInA=!1,r=p.normalize(),t=e-n)}d.push(g)}else if(1===n){if(s.copy(b.edges[g]),p.copy(a).sub(l[g]),n=x(s,p),-1===n){n=p.e();if(n>
e)return d.push(a),d.push(s),d.push(p),!1;c&&(c.bInA=!1,r=p.normalize(),t=e-n)}}else{g=s.f().normalize();n=p.c(g);q=Math.abs(n);if(0<n&&q>e)return d.push(a),d.push(g),d.push(p),!1;c&&(r=g,t=e-n,0<=n||t<2*e)&&(c.bInA=!1)}r&&c&&Math.abs(t)<Math.abs(c.overlap)&&(c.overlap=t,c.overlapN.copy(r))}c&&(c.a=b,c.b=k,c.overlapV.copy(c.overlapN).scale(c.overlap));d.push(a);d.push(s);d.push(p);return!0}function C(b,a,c){for(var d=b.calcPoints,e=d.length,h=a.calcPoints,l=h.length,f=0;f<e;f++)if(A(b.pos,a.pos,d,
h,b.normals[f],c))return!1;for(f=0;f<l;f++)if(A(b.pos,a.pos,d,h,a.normals[f],c))return!1;c&&(c.a=b,c.b=a,c.overlapV.copy(c.overlapN).scale(c.overlap));return!0}var m={};m.Vector=a;m.V=a;a.prototype.copy=a.prototype.copy=function(b){this.x=b.x;this.y=b.y;return this};a.prototype.clone=a.prototype.g=function(){return new a(this.x,this.y)};a.prototype.perp=a.prototype.f=function(){var b=this.x;this.x=this.y;this.y=-b;return this};a.prototype.rotate=a.prototype.rotate=function(b){var a=this.x,c=this.y;
this.x=a*Math.cos(b)-c*Math.sin(b);this.y=a*Math.sin(b)+c*Math.cos(b);return this};a.prototype.reverse=a.prototype.reverse=function(){this.x=-this.x;this.y=-this.y;return this};a.prototype.normalize=a.prototype.normalize=function(){var b=this.e();0<b&&(this.x/=b,this.y/=b);return this};a.prototype.add=a.prototype.add=function(b){this.x+=b.x;this.y+=b.y;return this};a.prototype.sub=a.prototype.sub=function(b){this.x-=b.x;this.y-=b.y;return this};a.prototype.scale=a.prototype.scale=function(b,a){this.x*=
b;this.y*=a||b;return this};a.prototype.project=a.prototype.i=function(b){var a=this.c(b)/b.d();this.x=a*b.x;this.y=a*b.y;return this};a.prototype.projectN=a.prototype.j=function(b){var a=this.c(b);this.x=a*b.x;this.y=a*b.y;return this};a.prototype.reflect=function(b){var a=this.x,c=this.y;this.i(b).scale(2);this.x-=a;this.y-=c;return this};a.prototype.reflectN=function(b){var a=this.x,c=this.y;this.j(b).scale(2);this.x-=a;this.y-=c;return this};a.prototype.dot=a.prototype.c=function(b){return this.x*
b.x+this.y*b.y};a.prototype.len2=a.prototype.d=function(){return this.c(this)};a.prototype.len=a.prototype.e=function(){return Math.sqrt(this.d())};m.Circle=function(b,k){this.pos=b||new a;this.r=k||0};m.Polygon=g;g.prototype.setPoints=function(b){this.points=b;this.recalc();return this};g.prototype.setAngle=function(b){this.angle=b;this.recalc();return this};g.prototype.setOffset=function(b){this.offset=b;this.recalc();return this};g.prototype.rotate=g.prototype.rotate=function(b){for(var a=this.points,
c=a.length,d=0;d<c;d++)a[d].rotate(b);this.recalc();return this};g.prototype.translate=g.prototype.translate=function(b,a){for(var c=this.points,d=c.length,e=0;e<d;e++)c[e].x+=b,c[e].y+=a;this.recalc();return this};g.prototype.recalc=g.prototype.recalc=function(){var b,k=this.calcPoints=[],c=this.edges=[],d=this.normals=[],e=this.points,h=this.offset,l=this.angle,f=e.length;for(b=0;b<f;b++){var g=e[b].g();k.push(g);g.x+=h.x;g.y+=h.y;0!==l&&g.rotate(l)}for(b=0;b<f;b++)e=k[b],e=(new a).copy(b<f-1?k[b+
1]:k[0]).sub(e),h=(new a).copy(e).f().normalize(),c.push(e),d.push(h);return this};m.Box=u;u.prototype.toPolygon=u.prototype.k=function(){var b=this.pos,k=this.w,c=this.h;return new g(new a(b.x,b.y),[new a,new a(k,0),new a(k,c),new a(0,c)])};m.Response=v;v.prototype.clear=v.prototype.clear=function(){this.bInA=this.aInB=!0;this.overlap=Number.MAX_VALUE;return this};for(var d=[],r=0;10>r;r++)d.push(new a);for(var q=[],r=0;5>r;r++)q.push([]);var y=new v,D=(new u(new a,1,1)).k();m.pointInCircle=function(b,
a){return d.pop().copy(b).sub(a.pos).d()<=a.r*a.r};m.pointInPolygon=function(b,a){D.pos.copy(b);y.clear();var c=C(D,a,y);c&&(c=y.aInB);return c};m.testCircleCircle=function(b,a,c){var g=d.pop().copy(a.pos).sub(b.pos),e=b.r+a.r,h=g.d();if(h>e*e)return d.push(g),!1;c&&(h=Math.sqrt(h),c.a=b,c.b=a,c.overlap=e-h,c.overlapN.copy(g.normalize()),c.overlapV.copy(g).scale(c.overlap),c.aInB=b.r<=a.r&&h<=a.r-b.r,c.bInA=a.r<=b.r&&h<=b.r-a.r);d.push(g);return!0};m.testPolygonCircle=B;m.testCirclePolygon=function(a,
d,c){if((a=B(d,a,c))&&c){d=c.a;var g=c.aInB;c.overlapN.reverse();c.overlapV.reverse();c.a=c.b;c.b=d;c.aInB=c.bInA;c.bInA=g}return a};m.testPolygonPolygon=C;return m}"function"===typeof define&&define.amd?define(w):"object"===typeof exports?module.exports=w():this.SAT=w();